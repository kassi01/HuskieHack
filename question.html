<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Huskie Hack</title>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="https://www.airmanopus.net/huskiehack/css/style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="https://www.airmanopus.net/huskiehack/js/say.js"></script>
<script>
var recognition = [];
var final_transcript = [];
var interim_transcript = [];
var NUM_QUESTIONS = 5;
var outputs = ['firstNameEcho','lastNameEcho','dateOfBirthEcho','painIndexEcho','chestPainEcho','thankYou'];


function init() {
  for(var k = 0; k < NUM_QUESTIONS; k++) {
    console.log(k);
    // set up a separate speech recognition listener for each of the questions
    recognition[k] = new webkitSpeechRecognition();
    recognition[k].continuous = true;
    recognition[k].interimResults = true;

    recognition[k].onerror = function(event) {
      console.log('error?');
      console.log(event);
    }

    recognition[k].onresult = function(event) {
      var interim_transcript = '';
      for (var i = event.resultIndex; i < event.results.length; i++) {
        if (event.results[i].isFinal) {
          final_transcript[k] += event.results[i][0].transcript;
        } else {
          interim_transcript[k] += event.results[i][0].transcript;
        }
      }
      final_transcript[k] = capitalize(final_transcript);
      document.getElementById(outputs[k]).innerHTML = linebreak(final_transcript);
      document.getElementById(outputs[k]).classList.remove('no-display');
    }
  }
}  


var first_char = /\S/;
function capitalize(s) {
  return s.replace(first_char, function(m) { 
      return m.toUpperCase(); 
  });
}

var two_line = /\n\n/g;
var one_line = /\n/g;
function linebreak(s) {
    return s.replace(two_line, '<p></p>').replace(one_line, '<br>');
}

function firstNameButton(event) {
  console.log('firstNameButton');
  final_transcript = '';
  recognition[0].lang = 'en_us';
  recognition[0].start();
}

function lastNameButton(event) {
  console.log('lastNameButton');
  final_transcript = '';
  recognition[1].lang = 'en_us';
  recognition[1].start();
}

function dateOfBirthButton(event) {
  console.log('dateOfBirthButton');
  final_transcript = '';
  recognition[2].lang = 'en_us';
  recognition[2].start();
}

function painIndexButton(event) {
  console.log('painIndexButton');
  final_transcript = '';
  recognition[3].lang = 'en_us';
  recognition[3].start();
}

function chestPainButton(event) {
  console.log('chestPainButton');
  final_transcript = '';
  recognition[4].lang = 'en_us';
  recognition[4].start();
}

</script>

</head>
<body>
<div class="container">
  <div class="row" id="row1">
    <div class="col-md-4"><center><span onclick="firstNameButton()"><img src="https://www.airmanopus.net/huskiehack/images/mic3.jpeg" border="0" height="150px" width="150px"></span></center></div>
    <div class="col-md-8 text-primary large_text" id="firstName">Please press the 'Push to Talk' button and then spell your first name.<br> <small>(Say each letter.)</small>
    <div class="well" id="firstNameEcho"></div>
    </div>
  </div>

  <div class="row no-display" id="row2">
    <div class="col-md-4"><center><span onclick="lastNameButton()"><img src="https://www.airmanopus.net/huskiehack/images/mic3.jpeg" border="0" height="150px" width="150px"></span></center></div>
    <div class="col-md-8 text-primary large_text" id="lastName">Please press the 'Push to Talk' button and then spell your last name.<br> <small>(Say each letter.)</small>
    <div class="well" id="lastNameEcho"></div>
  </div>

  <div class="row no-display" id="row3">
    <div class="col-md-4"><center><span onclick="dateOfBirthButton()"><img src="https://www.airmanopus.net/huskiehack/images/mic3.jpeg" border="0" height="150px" width="150px"></span></center></div>
    <div class="col-md-8 text-primary large_text" id="dateOfBirth">Please press the 'Push to Talk' button and say your birth date.<br> <small>(Say month, day and year.)</small>
    <div class="well" id="dateOfBirthEcho"></div>
  </div>

  <div class="row no-display" id="row4">
    <div class="col-md-4"><center><span onclick="painIndexButton()"><img src="https://www.airmanopus.net/huskiehack/images/mic3.jpeg" border="0" height="150px" width="150px"></span></center></div>
    <div class="col-md-8 text-primary large_text" id="painIndex">Please press the 'Push to Talk' button and indicate your level of pain <small>zero being none and ten being the highest possible.</small>
    <div class="well" id="painIndexEcho"></div>
  </div>

  <div class="row no-display" id="row5">
    <div class="col-md-4"><center><span onclick="chestPainButton()"><img src="https://www.airmanopus.net/huskiehack/images/mic3.jpeg" border="0" height="150px" width="150px"></span></center></div>
    <div class="col-md-8 text-primary large_text" id="chestPain">Please press the 'Push to Talk' button and tell us if you are feeling chest pain<small>(Say yes or no.)</small>
    <div class="well" id="chestPainEcho"></div>
  </div>

  <div class="row no-display">
    <div class="col-md-8 text-primary large_text" id="thankYou">Thank you! Someone will be with you as soon as possible.</div>
  </div>

</div>
</body>
</html>
